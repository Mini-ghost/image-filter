!function(t){var e={};function s(a){if(e[a])return e[a].exports;var n=e[a]={i:a,l:!1,exports:{}};return t[a].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=e,s.d=function(t,e,a){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(a,n,function(e){return t[e]}.bind(null,n));return a},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=2)}([function(t,e,s){},function(t,e,s){},function(t,e,s){"use strict";s.r(e);s(0),s(1);const a=function(t){return document.querySelector(t)};class n{constructor(t){this._start={x:0,y:0},this._canvas=t.el,this._ctx=t.el.getContext("2d"),this._state=Object.assign(Object.assign({},t.state),n.defaultStateOptions),"string"==typeof t.image&&this.setImage(t.image),this.initEventListener()}get hasImage(){return!!this._image}get filter(){return`brightness(${this._state.brightness+100}%) contrast(${this._state.contrast+100}%) saturate(${this._state.saturate+100}%)`}get state(){return this._state}set state(t){this._state=t,this.drawImage()}initEventListener(){const{documentElement:t}=document,e=this._canvas;let s=!1,a=0,n=0;const r=()=>{s&&(t.classList.remove("cursor-grabbing"),s=!1)};e.addEventListener("mouseenter",()=>{s&&t.classList.add("cursor-grabbing"),t.classList.add("cursor-grab")}),e.addEventListener("mouseleave",()=>{t.classList.remove("cursor-grab","cursor-grabbing")}),e.addEventListener("mousedown",e=>{s||(t.classList.add("cursor-grabbing"),a=e.clientX,n=e.clientY,s=!0)}),e.addEventListener("mouseup",r),e.addEventListener("mousemove",t=>{if(!s)return;const e=t.clientX-a,r=t.clientY-n;a=t.clientX,n=t.clientY,this._start.x+=e,this._start.y+=r,this.drawImage()}),t.addEventListener("mouseup",r),e.addEventListener("wheel",t=>{if(!t.ctrlKey)return;const{deltaY:e}=t,s=1-e/Math.abs(e)*.1,a=Math.max(this._state.scale*s,1);this.setState("scale",a),t.preventDefault()})}drawImage(){this.hasImage&&requestAnimationFrame(()=>{const{width:t,height:e}=this._canvas,{scale:s}=this._state;this._ctx.filter=this.filter,this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._ctx.drawImage(this._image,this._start.x-(s-1)*t*.5,this._start.y-(s-1)*e*.5,t*s,e*s)})}getImage(){if(this._image)return this._image;const t=this._image=new Image;return t.onload=()=>{this._canvas.width=this._image.width,this._canvas.height=this._image.height,this.drawImage()},t.onerror=()=>{throw new Error("圖片有問題!!!")},t}setImage(t){this.getImage().src=t}setState(t,e){this.state=Object.assign(Object.assign({},this.state),{[t]:e})}resetState(t){this.state=Object.assign(Object.assign({},n.defaultStateOptions),t)}saveImage({type:t=n.defaultSaveOptions.type,query:e=n.defaultSaveOptions.query}=n.defaultSaveOptions){this.hasImage&&this._canvas.toBlob(e=>{const s=URL.createObjectURL(e),a=document.createElement("a");a.href=s,a.download=`${Date.now()}.${t}`,a.click(),URL.revokeObjectURL(s)},"image/"+t,e)}}let r;function i(t,e){const s=r||(r=new FileReader);s.onload=t=>{e(t.target.result)},s.readAsDataURL(t[0])}n.defaultSaveOptions={type:"jpeg",query:.75},n.defaultStateOptions={brightness:0,contrast:0,saturate:0,scale:1};const o=new n({el:a("#canvas")}),c=(u="input[type='range']",document.querySelectorAll(u));var u;const l=a("#file"),d=a("#reset"),h=a("#download");l.addEventListener("input",t=>{const{files:e}=t.target;e&&i(e,t=>{t&&/^data\:image\//.test(t)&&o.setImage(t)})}),c.forEach(t=>{const{id:e}=t;t.value=""+o.state[e];let s=({target:e})=>{const{value:s,id:a}=e;o.setState(a,Number(s)),t.value=s};s=function(t){let e=!1;return function(){e||(e=!0,t.apply(this,arguments),requestAnimationFrame(()=>e=!1))}}(s),t.addEventListener("change",s),t.addEventListener("mousemove",s)}),d.addEventListener("click",t=>{o.resetState(),c.forEach(t=>{t.value=""+o.state[t.id]}),t.preventDefault()}),h.addEventListener("click",t=>{o.saveImage(),t.preventDefault()})}]);