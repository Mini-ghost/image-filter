!function(t){var e={};function n(a){if(e[a])return e[a].exports;var r=e[a]={i:a,l:!1,exports:{}};return t[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,a){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(a,r,function(e){return t[e]}.bind(null,r));return a},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=2)}([function(t,e,n){},function(t,e,n){},function(t,e,n){"use strict";n.r(e);n(0),n(1);var a=function(t){return document.querySelector(t)};var r=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)};function i(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var s,o=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._start={x:0,y:0},this.customState=void 0,this._canvas=e.el,this._ctx=e.el.getContext("2d"),this._state=Object.assign(Object.assign({},t.defaultStateOptions),e.state),this.customState=e.state,"string"==typeof e.image&&this.setImage(e.image),this.defineReactive(this._state),this.initEventListener()}var e,n,a;return e=t,(n=[{key:"defineReactive",value:function(t){for(var e=Object.keys(t),n=0,a=e.length;n<a;n++)c(t,e[n],this.drawImage.bind(this))}},{key:"initEventListener",value:function(){var t=this,e=document.documentElement,n=this._canvas,a=!1,r=0,i=0,s=function(){a&&(e.classList.remove("cursor-grabbing"),a=!1)};n.addEventListener("mouseenter",(function(){a&&e.classList.add("cursor-grabbing"),e.classList.add("cursor-grab")})),n.addEventListener("mouseleave",(function(){e.classList.remove("cursor-grab","cursor-grabbing")})),n.addEventListener("mousedown",(function(t){a||(e.classList.add("cursor-grabbing"),r=t.clientX,i=t.clientY,a=!0)})),n.addEventListener("mouseup",s),n.addEventListener("mousemove",(function(e){if(a){var n=e.clientX-r,s=e.clientY-i;r=e.clientX,i=e.clientY,t._start.x+=n,t._start.y+=s,t.drawImage()}})),e.addEventListener("mouseup",s),n.addEventListener("wheel",(function(e){if(e.ctrlKey){var n=e.deltaY,a=1-n/Math.abs(n)*.1,r=Math.max(t._state.scale*a,1);t.setState("scale",r),e.preventDefault()}}))}},{key:"drawImage",value:function(){var t=this;this.hasImage&&requestAnimationFrame((function(){var e=t._canvas,n=e.width,a=e.height,r=t._state.scale;t._ctx.filter=t.filter,t._ctx.clearRect(0,0,t._canvas.width,t._canvas.height),t._ctx.drawImage(t._image,t._start.x-(r-1)*n*.5,t._start.y-(r-1)*a*.5,n*r,a*r)}))}},{key:"getImage",value:function(){var t=this;if(this._image)return this._image;var e=this._image=new Image;return e.onload=function(){t._canvas.width=t._image.width,t._canvas.height=t._image.height,t.drawImage()},e.onerror=function(){throw new Error("圖片有問題!!!")},e}},{key:"setImage",value:function(t){this.getImage().src=t}},{key:"setState",value:function(t,e){r(this._state,t)?this._state[t]=e:console.error("state 沒有 ".concat(t," 屬性"))}},{key:"getState",value:function(t){if(r(this._state,t))return this._state[t];console.error("state 沒有 ".concat(t," 屬性"))}},{key:"resetState",value:function(){for(var e=Object.keys(this._state),n=t.defaultStateOptions,a=0,r=e.length;a<r;a++){var i=e[a];this._state[i]=this.customState&&this.customState[i]||n[i]}}},{key:"saveImage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.defaultSaveOptions,n=e.type,a=void 0===n?t.defaultSaveOptions.type:n,r=e.query,i=void 0===r?t.defaultSaveOptions.query:r;this.hasImage&&this._canvas.toBlob((function(t){var e=URL.createObjectURL(t),n=document.createElement("a");n.href=e,n.download="".concat(Date.now(),".").concat(a),n.click(),URL.revokeObjectURL(e)}),"image/".concat(a),i)}},{key:"hasImage",get:function(){return!!this._image}},{key:"filter",get:function(){return"brightness(".concat(this._state.brightness+100,"%) ")+"contrast(".concat(this._state.contrast+100,"%) ")+"saturate(".concat(this._state.saturate+100,"%)")}}])&&i(e.prototype,n),a&&i(e,a),t}();function c(t,e,n){var a=t[e];Object.defineProperty(t,e,{enumerable:!0,configurable:!0,get:function(){return a},set:function(t){t!==a&&(a=t,"function"==typeof n&&n())}})}function u(t,e){var n=s||(s=new FileReader);n.onload=function(t){e(t.target.result)},n.readAsDataURL(t[0])}o.defaultSaveOptions={type:"jpeg",query:.75},o.defaultStateOptions={brightness:0,contrast:0,saturate:0,scale:1};var l,f=new o({el:a("#canvas")}),d=(l="input[type='range']",document.querySelectorAll(l)),v=a("#file"),g=a("#reset"),h=a("#download");v.addEventListener("input",(function(t){var e=t.target.files;e&&u(e,(function(t){t&&/^data\:image\//.test(t)&&f.setImage(t)}))})),d.forEach((function(t){var e=t.id;t.value="".concat(f.getState(e));var n,a,r=function(e){var n=e.target,a=n.value,r=n.id;f.setState(r,Number(a)),t.value=a};n=r,a=!1,r=function(){a||(a=!0,n.apply(this,arguments),requestAnimationFrame((function(){return a=!1})))},t.addEventListener("change",r),t.addEventListener("mousemove",r)})),g.addEventListener("click",(function(t){f.resetState(),d.forEach((function(t){t.value="".concat(f.getState(t.id))})),t.preventDefault()})),h.addEventListener("click",(function(t){f.saveImage(),t.preventDefault()}))}]);