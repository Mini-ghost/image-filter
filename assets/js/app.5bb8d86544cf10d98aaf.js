!function(e){var t={};function n(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(a,r,function(t){return e[t]}.bind(null,r));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){},function(e,t,n){"use strict";n.r(t);n(0);var a=function(e){return document.querySelector(e)};var r=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};function i(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var s,o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.customState=void 0,this.destroyEvents=[],this.canvas=t.el,this.ctx=t.el.getContext("2d"),"string"==typeof t.image&&this.setImage(t.image),this.initState(t.state),this.initEvent()}var t,n,a;return t=e,(n=[{key:"initState",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.defaultState,a=Object.keys(n);this.customState=t,this.state=Object.assign(Object.assign({},n),t);for(var r=0,i=a.length;r<i;r++)u(this.state,a[r],this.drawImage.bind(this))}},{key:"initEvent",value:function(){this.destroyEvents.push(this.dragEvent(),this.zoomEvent())}},{key:"dragEvent",value:function(){var e=this,t=document.documentElement,n=this.canvas,a=!1,r=0,i=0,s=function(){a&&t.classList.add("cursor-grabbing"),t.classList.add("cursor-grab")},o=function(){t.classList.remove("cursor-grab","cursor-grabbing")},u=function(e){a||(t.classList.add("cursor-grabbing"),r=e.clientX,i=e.clientY,a=!0)},c=function(){a&&(t.classList.remove("cursor-grabbing"),a=!1)},v=function(t){if(a){var n=t.clientX-r,s=t.clientY-i;r=t.clientX,i=t.clientY,e.state.x+=n,e.state.y+=s}};return n.addEventListener("mouseenter",s),n.addEventListener("mouseleave",o),n.addEventListener("mousedown",u),n.addEventListener("mouseup",c),n.addEventListener("mousemove",v),t.addEventListener("mouseup",c),function(){n.removeEventListener("mouseenter",s),n.removeEventListener("mouseleave",o),n.removeEventListener("mousedown",u),n.removeEventListener("mouseup",c),n.removeEventListener("mousemove",v),t.removeEventListener("mouseup",c)}}},{key:"zoomEvent",value:function(){var e=this,t=this.canvas,n=function(t){if(t.ctrlKey){var n=t.deltaY,a=1-n/Math.abs(n)*.1,r=Math.max(e.state.scale*a,1);e.setState("scale",r),t.preventDefault()}};return t.addEventListener("wheel",n),function(){t.removeEventListener("wheel",n)}}},{key:"drawImage",value:function(){var e=this;this.hasImage&&requestAnimationFrame((function(){var t=e.canvas,n=t.width,a=t.height,r=e.state.scale;e.ctx.filter=e.filter,e.ctx.clearRect(0,0,e.canvas.width,e.canvas.height),e.ctx.drawImage(e.image,e.state.x-(r-1)*n*.5,e.state.y-(r-1)*a*.5,n*r,a*r)}))}},{key:"getImage",value:function(){var e=this;if(this.image)return this.image;var t=this.image=new Image;return t.onload=function(){e.canvas.width=e.image.width,e.canvas.height=e.image.height,e.drawImage()},t.onerror=function(){throw new Error("圖片有問題!!!")},t}},{key:"setImage",value:function(e){this.getImage().src=e}},{key:"setState",value:function(e,t){r(this.state,e)?this.state[e]=t:console.error("state 沒有 ".concat(e," 屬性"))}},{key:"getState",value:function(e){if(r(this.state,e))return this.state[e];console.error("state 沒有 ".concat(e," 屬性"))}},{key:"resetState",value:function(){for(var t=Object.keys(this.state),n=e.defaultState,a=0,r=t.length;a<r;a++){var i=t[a];this.state[i]=this.customState&&this.customState[i]||n[i]}}},{key:"saveImage",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.defaultSaveOptions,n=t.type,a=void 0===n?e.defaultSaveOptions.type:n,r=t.query,i=void 0===r?e.defaultSaveOptions.query:r;this.hasImage&&this.canvas.toBlob((function(e){var t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="".concat(Date.now(),".").concat(a),n.click(),URL.revokeObjectURL(t)}),"image/".concat(a),i)}},{key:"destroy",value:function(){this.state=null;for(var e=this.destroyEvents.length,t=0;t<e;t++)this.destroyEvents[t]()}},{key:"hasImage",get:function(){return!!this.image}},{key:"filter",get:function(){return"brightness(".concat(this.state.brightness+100,"%) ")+"contrast(".concat(this.state.contrast+100,"%) ")+"saturate(".concat(this.state.saturate+100,"%)")}}])&&i(t.prototype,n),a&&i(t,a),e}();function u(e,t,n){var a=e[t];Object.defineProperty(e,t,{enumerable:!0,configurable:!0,get:function(){return a},set:function(e){e!==a&&(a=e,"function"==typeof n&&n())}})}function c(e,t){var n=s||(s=new FileReader);n.onload=function(e){t(e.target.result)},n.readAsDataURL(e[0])}o.defaultSaveOptions={type:"jpeg",query:.75},o.defaultState={brightness:0,contrast:0,saturate:0,scale:1,x:0,y:0};var v,l=new o({el:a("#canvas")}),f=(v="input[type='range']",document.querySelectorAll(v)),d=a("#file"),h=a("#reset"),m=a("#download");d.addEventListener("input",(function(e){var t=e.target.files;t&&c(t,(function(e){e&&/^data\:image\//.test(e)&&l.setImage(e)}))})),f.forEach((function(e){var t=e.id;e.value="".concat(l.getState(t));var n,a,r=function(t){var n=t.target,a=n.value,r=n.id;l.setState(r,Number(a)),e.value=a};n=r,a=!1,r=function(){a||(a=!0,n.apply(this,arguments),requestAnimationFrame((function(){return a=!1})))},e.addEventListener("change",r),e.addEventListener("mousemove",r)})),h.addEventListener("click",(function(e){l.resetState(),f.forEach((function(e){e.value="".concat(l.getState(e.id))})),e.preventDefault()})),m.addEventListener("click",(function(e){l.saveImage(),e.preventDefault()}))}]);